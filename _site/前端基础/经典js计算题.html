<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="UTF-8">
  <title>前端技术</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/Front-end-learning/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/Front-end-learning/css/cayman.css">
  <link rel="stylesheet" href="/Front-end-learning/css/font-awesome.min.css">
  <link rel="stylesheet" href="/Front-end-learning/css/highlight.css">
  <link rel="import" href="/Front-end-learning/webcomponent/github-card.html">
</head>

  <body>
    <section class="page-header">
    <h1 class="project-name"><a href="/Front-end-learning/README">前端技术</a></h1>
    <h2 class="project-tagline">逸飞的前端打怪日常，主要是javascript</h2>
    <a href="https://github.com/panyifei/Front-end-learning" class="btn">View on GitHub</a>
    <a href="https://github.com/panyifei/Front-end-learning/archive/master.zip" class="btn">Download .zip</a>
</section>

    <section class="main-content">
      <h2>经典js计算题</h2>

<p>这道题摘自<a href="http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&amp;mid=402252398&amp;idx=1&amp;sn=f163fcc3637f57cd53678e7dd3bea19e&amp;scene=23&amp;srcid=0229uS9TwUS3TYlRIguAgT9v#rd">微信的一篇文章</a>，坑可谓是很多，而且很细节。</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">};</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">2</span><span class="p">);};</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">3</span><span class="p">);};</span>
<span class="kd">var</span> <span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">4</span><span class="p">);};</span>
<span class="kd">function</span> <span class="nx">getName</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">5</span><span class="p">);}</span>
<span class="c1">//写出下面的结果</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span><span class="c1">//2</span>
<span class="nx">getName</span><span class="p">();</span><span class="c1">//4</span>
<span class="nx">Foo</span><span class="p">().</span><span class="nx">getName</span><span class="p">();</span><span class="c1">//1</span>
<span class="nx">getName</span><span class="p">();</span><span class="c1">//1</span>
<span class="k">new</span> <span class="nx">Foo</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span><span class="c1">//2</span>
<span class="k">new</span> <span class="nx">Foo</span><span class="p">().</span><span class="nx">getName</span><span class="p">();</span><span class="c1">//3</span>
<span class="k">new</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">().</span><span class="nx">getName</span><span class="p">();</span><span class="c1">//3</span>
</code></pre></div>
<p>一个一个地分析：</p>

<h3>Foo.getName()</h3>

<p>这个访问的自然是Foo函数上的结果，也没有被覆盖过，所以结果是2.</p>

<h3>getName()</h3>

<p>这个结果有点意思，主要是要理解变量提升。</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">4</span><span class="p">);};</span>
<span class="kd">function</span> <span class="nx">getName</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span> <span class="p">(</span><span class="mi">5</span><span class="p">);}</span>
</code></pre></div>
<p>这个的实际执行其实是：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">getName</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">getName</span><span class="p">(){</span><span class="nx">alert</span><span class="p">(</span><span class="mi">5</span><span class="p">);}</span>
<span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">alert</span><span class="p">(</span><span class="mi">4</span><span class="p">);}</span>
</code></pre></div>
<p>所以最后的值是4。</p>

<h3>Foo().getName()</h3>

<p>这里调用了Foo方法。Foo方法里面对getName进行了赋值，但是因为没有加上var，所以会向外查找作用域，在全局中找到了getName，所以进行赋值。(如果没有找到的话，则会在全局中创建这个变量)。然后return this，其实就是window。</p>

<p>然后调用window.getName()，得到的值就是1了。</p>

<h3>getName()</h3>

<p>经过了上面的分析，现在全局里面的值就是1了。</p>

<h3>new Foo.getName()</h3>

<p>这里考察了运算符的优先级</p>

<p>通过查询文档可以知道，(.)的优先级高于new，所以这里实际上是将Foo.getName作为了构造函数，所以结果是2。</p>

<h3>new Foo().getName()</h3>

<p>这里的话，带参数列表的new与(.)的优先级一样，所以从右向左，先执行构造函数，然后执行方法的查询调用。</p>

<p>这里构造函数的话，注意如果有return语句的话，得看return的是什么东西，如果不是引用类型，那么与无return一样！！但是如果是引用类型，就会被return的东西所替代。当然如果return的是this的话，就没啥关系了。所以会去原型链上找，得到的结果就是3了。</p>

<h3>new new Foo().getName()</h3>

<p>这个也是个运算符优先级问题，就是new ((new Foo()).getName)();等于最后就是将那个原型链的方法作为了构造函数调用，得到的结果就是3了。</p>

      <div id="disqus_thread"></div>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//panyifei.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script id="dsq-count-scr" src="//panyifei.disqus.com/count.js" async></script>

      <!-- <footer class="site-footer">
  <span class="site-footer-owner"><a href="">前端技术</a> is maintained by <a href="https://github.com/panyifei">逸飞</a>.</span>
</footer> -->

<footer>
	<div class="span-inline">
		
			<span>
				<a target="_blank" href="https://github.com/panyifei">
					<span class="fa-stack fa-lg">
						<i class="fa fa-circle fa-stack-2x"></i>
						<i class="fa fa-github fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			</span>
		
		
			<span>
				<a target="_blank" href="https://www.zhihu.com/people/pan-yi-fei-41">
					<span class="fa-stack fa-lg">
						<i class="fa fa-circle fa-stack-2x"></i>
						<i class="fa  fa-stack-1x fa-inverse">知</i>
					</span>
				</a>
			</span>
		
		
			<span>
				<a target="_blank" href="http://www.jianshu.com/users/3b9067fb7edf">
					<span class="fa-stack fa-lg">
						<i class="fa fa-circle fa-stack-2x"></i>
						<i class="fa  fa-stack-1x fa-inverse">简</i>
					</span>
				</a>
			</span>
		
	</div>
	<p class="copyright">
		Copyright &copy; 前端技术 2016
		<br>
		Owned by <a href="https://github.com/panyifei">潘逸飞</a>
	</p>
</footer>

    </section>
  </body>
</html>
