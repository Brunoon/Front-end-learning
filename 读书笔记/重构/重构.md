---
layout: default
title: {{ site.name }}
---
# 重构
重构就是在不改变代码外在行为的前提下，对代码做出修改，来改进内部结构。一般情况下代码会慢慢沉沦，但是重构与之相反，甚至每一步都可以很简单，把字段从一个类移到另一个类，某些代码从一个函数拉出来变成另一个函数，或者在继承体系中把某些代码推上推下就行了。

## 重构的第一个案例
如果你发现你需要为程序加一个特性，但是代码结构无法让你很方便的达成目的，那就重构程序，让它的添加比较容易进行，然后再添加特性。

重构首先保证你得有可靠的测试环境，因为避免绝大多数引入bug的事情。好的测试是重构的根本，花时间建立一个优良的测试机制是完全值得的。

### 第一步
第一步是找出逻辑泥团，然后找函数中的局部变量以及参数，如果没有变化的就直接作为参数传入，如果变化的了，那就可以作为返回值返回。

  重构就是以微小的步伐修改程序。

### 第二步
改名，好的代码应该可以表达自己的功能，变量名称是代码清晰的关键。

### 第三步
看代码有没有放错地方，功能要放在他应该在的地方。

### 第四步
去除临时变量，就是类似于我们现在用到的selector，就是computed state，这个不应该每次都计算一次，而是应该提取出来，每次调用的时候调用方法来拿取，这样更少的临时变量。

### 第五步
不要在另一个对象的属性基础上运用switch语句，如果要使用，也要在对象自己的数据上使用。

## 重构原则
重构是在不改变软件可观察行为的前提下，提高可理解性，降低修改成本。重构都是软件的小改动。
重构是使用一系列重构手法，不改白软件可观察行为的前提下，调整结构。

与之形成对比的性能优化，性能优化通常不会改变组件的行为，除了执行速度，性能优化往往使得代码较难理解。

### 重构的目的
没有重构，程序的设计会逐渐变质，重构就是在整理代码，改进设计的一个重要方向就是消除重复代码。

使程序更容易理解，很多时候阅读者是自己，用重构来理解不熟悉的代码。早起的重构可能就是擦掉窗户上污垢。然后就会进入更高的理解层次上。

重构可以帮忙找bug，因为可以深入理解，然后把新的理解反馈回去。

重构可以提高编程速度，可以提高设计质量。

### 重构法则
三次法则：第一次尽管做，第二次虽然不爽还是可以做，第三次就应该重构了。

这句话的感触太深了，经常会遇到一个代码写到第三次忍不了的情况。

 - 最常见的是添加新特性的时候重构，来让自己更快的理解。
 - 修补错误的时候觉得代码不够清晰从而进行重构
 - 复审代码重构

系统当下的行为只是整个故事的一部分，如果为了今天的任务不择手段，不能完成明天的任务，那最终还会回失败。

更小的发布接口

何时不该重构：我们可以将大块软件重构为封装良好的小型组件，然后逐一对组件做出重构还是重建的决定。

我们如果用了重构的话，可以不要求最开始的就是最优的设计。

很多时候我们并不一定需要提前设计很多的灵活性，我们只需要考虑把当前的简单方案重构成灵活的方案的代价大不大，如果不大，直接实现目前的简单方案就好了。

哪怕我们完全了解系统，也先实际度量一下它的性能，臆测绝大多数都是错的。
